<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>E-Commerce Filter System (Testing Lab)</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; max-width: 1200px; margin: 0 auto; padding: 20px; }
    .filters { display: flex; gap: 20px; margin-bottom: 30px; padding: 15px; background: #f8f9fa; border-radius: 8px; }
    .filter-group { flex: 1; }
    label { display: block; margin-bottom: 5px; font-weight: 600; }
    select, input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
    button { padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .products { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
    .product-card { border: 1px solid #eee; padding: 15px; border-radius: 8px; }
    .product-card h3 { margin-top: 0; }
    .price { font-weight: bold; color: #d63384; }
    .error { color: #dc3545; font-size: 0.9em; margin-top: 5px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>Smartphone Marketplace</h1>
  
  <!-- Filter System (Primary Test Target) -->
  <div class="filters">
    <div class="filter-group">
      <label for="brand">Brand</label>
      <select id="brand">
        <option value="">All Brands</option>
        <option value="apple">Apple</option>
        <option value="samsung">Samsung</option>
        <option value="google">Google</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="price-range">Price Range ($)</label>
      <select id="price-range">
        <option value="">Any</option>
        <option value="0-500">0 - 500</option>
        <option value="500-1000">500 - 1000</option>
        <option value="1000-1500">1000 - 1500</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="storage">Storage (GB)</label>
      <input type="number" id="storage" min="64" max="1024" placeholder="e.g., 128">
      <div id="storage-error" class="error hidden">Must be between 64-1024</div>
    </div>

    <div class="filter-group">
      <label>&nbsp;</label>
      <button id="apply-filters">Apply Filters</button>
    </div>
  </div>

  <!-- Product Grid -->
  <div class="products" id="products">
    <!-- Dynamically filled by JavaScript -->
  </div>

  <script>
    // Product Data (Boundary Values: Min/Max Price, Storage)
    const products = [
      { id: 1, brand: 'apple', name: 'iPhone 13', price: 799, storage: 128 },
      { id: 2, brand: 'samsung', name: 'Galaxy S22', price: 999, storage: 256 },
      { id: 3, brand: 'google', name: 'Pixel 6', price: 599, storage: 128 },
      { id: 4, brand: 'apple', name: 'iPhone SE', price: 429, storage: 64 },
      { id: 5, brand: 'samsung', name: 'Galaxy Z Flip', price: 1299, storage: 512 },
      { id: 6, brand: 'apple', name: 'iPhone 14 Pro', price: 1499, storage: 1024 }
    ];

    // DOM Elements
    const brandFilter = document.getElementById('brand');
    const priceFilter = document.getElementById('price-range');
    const storageInput = document.getElementById('storage');
    const storageError = document.getElementById('storage-error');
    const applyBtn = document.getElementById('apply-filters');
    const productsContainer = document.getElementById('products');

    // Initialize
    document.addEventListener('DOMContentLoaded', renderProducts(products));

    // --- Core Functions for Testing ---

    /**
     * Applies all filters (Black-box: Decision Table, Equivalence Partitioning)
     * @returns {boolean} False if validation fails
     */
    function applyFilters() {
      const brand = brandFilter.value;
      const priceRange = priceFilter.value;
      const storage = parseInt(storageInput.value);

      // Validate storage input (Boundary Analysis)
      if (storageInput.value && (storage < 64 || storage > 1024)) {
        storageError.classList.remove('hidden');
        return false;
      } else {
        storageError.classList.add('hidden');
      }

      // Filter logic
      let filtered = [...products];

      if (brand) {
        filtered = filtered.filter(p => p.brand === brand);
      }

      if (priceRange) {
        const [min, max] = priceRange.split('-').map(Number);
        filtered = filtered.filter(p => p.price >= min && p.price <= max); // Bug: Doesn't handle "1000-1500" correctly
      }

      if (storage) {
        filtered = filtered.filter(p => p.storage === storage); // Intentional: Exact match only
      }

      renderProducts(filtered);
      return true;
    }

    /**
     * Renders products to the DOM (White-box: Statement Coverage)
     * @param {Array} products - Products to display
     */
    function renderProducts(products) {
      if (products.length === 0) {
        productsContainer.innerHTML = '<p class="no-results">No products match your filters.</p>';
        return;
      }

      let html = '';
      products.forEach(product => {
        html += `
          <div class="product-card" data-id="${product.id}">
            <h3>${product.name}</h3>
            <p>Brand: ${product.brand}</p>
            <p class="price">$${product.price.toFixed(2)}</p>
            <p>Storage: ${product.storage}GB</p>
          </div>
        `;
      });
      productsContainer.innerHTML = html;
    }

    // Event Listeners
    applyBtn.addEventListener('click', applyFilters);
  </script>
</body>
</html>
